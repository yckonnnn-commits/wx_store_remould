# AI 微信小店客服系统

基于 Python + PySide6 开发的 AI 智能客服系统，专为微信小店设计。系统通过内嵌浏览器加载微信小店客服页面，利用 JavaScript 注入技术自动抓取用户消息，调用大语言模型生成回复，并自动发送给用户。

## 功能特点

- 🤖 **多模型支持**: 支持 ChatGPT、Gemini、阿里千问、DeepSeek、豆包、Kimi 等多种大语言模型
- 📚 **知识库管理**: 内置知识库系统，支持快速匹配常见问题和答案
- 🌐 **浏览器集成**: 内嵌浏览器，直接加载微信小店客服页面
- ⚡ **自动回复**: 定时检测未读消息，自动进入会话并回复
- 💾 **配置管理**: 支持多模型配置，配置自动保存
- 📝 **日志记录**: 详细的运行日志，方便调试和监控

## 项目结构

```
wx_store_index/
├── main.py                      # 程序入口
├── requirements.txt             # 依赖列表
├── README.md                    # 项目说明
│
├── config/                      # 配置文件目录
│   ├── model_settings.json      # 模型配置
│   └── knowledge_base.json      # 知识库数据
│
├── src/                         # 源代码目录
│   ├── data/                    # 数据层
│   │   ├── config_manager.py    # 配置管理器
│   │   └── knowledge_repository.py # 知识库存储
│   │
│   ├── services/                # 服务层
│   │   ├── llm_service.py       # LLM API服务
│   │   ├── browser_service.py   # 浏览器控制服务
│   │   └── knowledge_service.py # 知识库服务
│   │
│   ├── core/                    # 业务逻辑层
│   │   ├── message_processor.py # 消息处理器
│   │   ├── reply_coordinator.py # 回复协调器
│   │   └── session_manager.py   # 会话管理器
│   │
│   ├── ui/                      # 表现层
│   │   ├── main_window.py       # 主窗口
│   │   ├── left_panel.py        # 左侧面板
│   │   ├── browser_tab.py       # 浏览器标签页
│   │   ├── knowledge_tab.py     # 知识库标签页
│   │   └── model_config_tab.py  # 模型配置标签页
│   │
│   └── utils/                   # 工具模块
│       └── constants.py         # 常量定义
│
└── docs/                        # 文档目录
    └── architecture.md          # 架构设计文档
```

## 安装运行

### 环境要求

- Python 3.8+
- PySide6 6.4+

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

```bash
python main.py
```

## 使用说明

### 1. 首次配置

1. 打开程序后，切换到「模型配置」标签页
2. 选择要使用的 AI 模型（如 ChatGPT、Gemini 等）
3. 填写对应模型的 API 地址和 API 密钥
4. 点击「保存配置」

### 2. 配置知识库

1. 切换到「知识库」标签页
2. 点击「添加」按钮添加常见问题和答案
3. 支持导入/导出 JSON 格式的知识库

### 3. 启动 AI 客服

1. 确保左侧「微信小店」标签页已加载客服页面
2. 点击「启动 AI」按钮开始自动回复
3. 系统会自动检测未读消息并进行回复

### 4. 环境变量配置（可选）

在项目根目录创建 `.env` 文件：

```
OPENAI_API_KEY=your_api_key_here
GEMINI_API_KEY=your_api_key_here
```

## 核心流程

```
┌─────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  定时器  │───▶│  扫描未读    │───▶│  点击进入    │───▶│  抓取消息    │
│ (4秒)   │    │  消息       │    │  会话       │    │             │
└─────────┘    └─────────────┘    └─────────────┘    └──────┬──────┘
                                                             │
┌─────────┐    ┌─────────────┐    ┌─────────────┐          │
│  发送   │◀───│  注入JS     │◀───│  生成回复    │◀─────────┘
│  回复   │    │  发送消息   │    │  (LLM/知识库)│
└─────────┘    └─────────────┘    └─────────────┘
```

## 架构说明

项目采用分层架构设计：

- **UI 层**: 负责界面展示和用户交互
- **Core 层**: 负责业务流程控制和状态管理
- **Services 层**: 负责与外部服务和底层操作
- **Data 层**: 负责数据持久化和配置管理

详细架构设计请参考 [docs/architecture.md](docs/architecture.md)

## 注意事项

1. **API 密钥安全**: 请妥善保管 API 密钥，不要提交到版本控制
2. **频率限制**: 注意各大模型 API 的调用频率限制
3. **微信规则**: 请遵守微信小店的使用规则，合理使用自动化工具
4. **网络环境**: 部分模型需要特定的网络环境才能访问

## 许可证

MIT License

## 更新日志

### v2.0.0 (2026-02-02)

- 重构项目架构，采用分层设计
- 模块化代码结构，提高可维护性
- 新增配置管理、会话管理等功能
- 优化消息处理流程
